<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/Quark/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/Quark/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/Quark/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/Quark/images/logo.svg" color="#222">

<link rel="stylesheet" href="/Quark/css/main.css">


<link rel="stylesheet" href="/Quark/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chrisz-nju.github.io","root":"/Quark/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":240,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="——Feb,21,2021  目录 本次项目采用正点原子STM32F407探索者开发版和STM32cubeIDE软件开发  I2C协议介绍 STM32上I2C的实现 STM32F4探索者I2C实验">
<meta property="og:type" content="article">
<meta property="og:title" content="STM32单片机HAL库学习MacOS(5)——I2C通信">
<meta property="og:url" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/index.html">
<meta property="og:site_name" content="Qurak">
<meta property="og:description" content="——Feb,21,2021  目录 本次项目采用正点原子STM32F407探索者开发版和STM32cubeIDE软件开发  I2C协议介绍 STM32上I2C的实现 STM32F4探索者I2C实验">
<meta property="og:locale">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/I2C总线连接图.png">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/I2C通信流程图.jpg">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/起止信号时序图.jpg">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/%E5%BA%94%E7%AD%94%E4%BF%A1%E5%8F%B7%E6%97%B6%E5%BA%8F%E5%9B%BE.png">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/配置时钟树.png">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/Key配置.png">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/24C02硬件连接.png">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/I2C%E9%85%8D%E7%BD%AE.png">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/24c02地址.png">
<meta property="og:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/24c02%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F.png">
<meta property="article:published_time" content="2021-02-20T16:00:00.000Z">
<meta property="article:modified_time" content="2021-07-07T13:48:30.300Z">
<meta property="article:author" content="Chris">
<meta property="article:tag" content="STM32cubeIDE">
<meta property="article:tag" content="STM32">
<meta property="article:tag" content="I2C">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/STM32单片机HAL库学习（macOS）（5）——I2C通信/I2C总线连接图.png">

<link rel="canonical" href="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>STM32单片机HAL库学习MacOS(5)——I2C通信 | Qurak</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/Quark/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Qurak</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Make Code Talk</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/Quark/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/Quark/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/Quark/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://chrisz-nju.github.io/Quark/2021/02/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://gitee.com/zhuang-jiaxin_gitee/pictures/raw/master/img/0df431adcbef76096e34ebdc26dda3cc7cd99eb1-20210706060646187.jpeg">
      <meta itemprop="name" content="Chris">
      <meta itemprop="description" content="I hope that I am a pioneer and my efforts can bring better technology and things to everyone.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qurak">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          STM32单片机HAL库学习MacOS(5)——I2C通信
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-21 00:00:00" itemprop="dateCreated datePublished" datetime="2021-02-21T00:00:00+08:00">2021-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-07-07 21:48:30" itemprop="dateModified" datetime="2021-07-07T21:48:30+08:00">2021-07-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Quark/categories/STM32%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">STM32学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>——Feb,21,2021</p>
<h2 id="目录"><a class="markdownIt-Anchor" href="#目录"></a> 目录</h2>
<p>本次项目采用正点原子STM32F407探索者开发版和STM32cubeIDE软件开发</p>
<ul>
<li>I2C协议介绍</li>
<li>STM32上I2C的实现</li>
<li>STM32F4探索者I2C实验</li>
</ul>
<span id="more"></span>
<h2 id="一-i2c协议介绍"><a class="markdownIt-Anchor" href="#一-i2c协议介绍"></a> 一、I2C协议介绍</h2>
<h3 id="1-i2c通信原理"><a class="markdownIt-Anchor" href="#1-i2c通信原理"></a> 1、I2C通信原理</h3>
<ul>
<li>
<p><strong>I2C通讯协议(Inter－Integrated Circuit)<strong>引脚少，硬件实现简单，可扩展性强，不需要USART、CAN等通讯协议的外部收发设备，现在被广泛地使用在系统内多个集成电路(IC)间的通讯。支持双向传输，但是由于公用数据线只能实现</strong>半双工通信</strong>，大部分I2C设备支持<strong>100KHz</strong>和<strong>400KHz</strong>模式，一些设备还支持3.4MbHz高速模式。</p>
</li>
<li>
<p>I2C通信硬件十分简单，最少仅需要2条数据线：</p>
<ul>
<li>
<p><strong>SDA</strong> (Serial Data,  串行数据 )</p>
</li>
<li>
<p><strong>SCL</strong> (Serial Clock, 串行时钟 )</p>
</li>
<li>
<p>在一些情况下需要额外的数据线寻址。</p>
</li>
<li>
<p>物理层示意图：</p>
</li>
</ul>
  <img src="STM32单片机HAL库学习（macOS）（5）——I2C通信/I2C总线连接图.png" alt="I2C总线连接图" style="zoom:80%;" />
</li>
<li>
<p><strong>设备连接和寻找</strong>：每个连接到总线的设备都有<strong>一个独立的地址</strong>（7位或10位），主机可以利用这个地址进行不同设备之间的访问。其中地址若是<strong>7位</strong>二进制数表示的话，<strong>高四位</strong>为设备固有地址，<strong>后三位</strong>地址由用户设置，因此同一个设备最多可以连接<strong>8</strong>个。在通信开始后，主机发送的第一个字节为寻址信号，当从机的地址与寻址信号相<strong>匹配</strong>时才会与主机建立通信。</p>
</li>
<li>
<p><strong>通信进程</strong>：<code>S</code>—&gt;<code>Slave Address</code>—&gt;<code>R/W</code>—&gt;<code>A</code>—&gt;<code>Data</code>-&gt;…-&gt;<code>NA</code>—&gt;<code>P</code></p>
<p>(S：开始信号，A：应答信号，保证通信过程没有断开，NA：非应答信号，P：停止信号）<img src="STM32单片机HAL库学习（macOS）（5）——I2C通信/I2C通信流程图.jpg" alt="I2C通信流程图" style="zoom:80%;" /></p>
</li>
</ul>
<h3 id="2-i2c时序图"><a class="markdownIt-Anchor" href="#2-i2c时序图"></a> 2、I2C时序图</h3>
<ul>
<li>
<p><strong>起始信号</strong>(S)：当<strong>时钟线</strong> (SCL线)为高时，<strong>数据线</strong>(SDA 线)从高到低；<strong>停止信号</strong>§：当<strong>时钟线</strong> (SCL线)是高时，<strong>数据线</strong>(SDA 线)由低到高切换。<img src="STM32单片机HAL库学习（macOS）（5）——I2C通信/起止信号时序图.jpg" alt="起止信号时序图" style="zoom:80%;" /></p>
</li>
<li>
<p><strong>传输</strong>：I2C使用SDA信号线来传输数据，使用SCL信号线进行数据同步。SDA数据线在SCL的每个时钟周期传输一位数据。传输时，SCL为高时SDA数据<strong>有效</strong>，即此时的SDA为高电平时表示数据“1”，为低电平时表示数据“0”。当SCL为低时，SDA数据<strong>无效</strong>，一般在这个时候SDA进行电平切换，为下一次表示数据做好准备。</p>
</li>
<li>
<p><strong>应答</strong>：I2C的数据和地址传输都带响应。响应包括“应答(ACK)”和“非应答(NACK)”两种信号。一般数据都是以字节（8bits）的形式发送在第九个CLK周期时，主机为接收模式等待从机的应答信号，若收到低电平为A信号，高电平为NA信号</p>
<p><img src="STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/%E5%BA%94%E7%AD%94%E4%BF%A1%E5%8F%B7%E6%97%B6%E5%BA%8F%E5%9B%BE.png" alt="应答信号时序图" /></p>
</li>
</ul>
<h2 id="二-stm32上i2c的实现"><a class="markdownIt-Anchor" href="#二-stm32上i2c的实现"></a> 二、STM32上I2C的实现</h2>
<h3 id="1-利用io口模拟i2c实现通信"><a class="markdownIt-Anchor" href="#1-利用io口模拟i2c实现通信"></a> 1、利用IO口模拟I2C实现通信</h3>
<ul>
<li>
<p><strong>优点</strong>：可以用在任意引脚，方便外接外设；流程清楚，稳定；</p>
</li>
<li>
<p><strong>缺点</strong>：占用CPU，效率不如；用IO口模拟，速度较慢；</p>
</li>
<li>
<p><strong>实现方法</strong>：根据时序图软件编程</p>
<ul>
<li>初始化两个IO口分别作为SDA和SCL</li>
<li>S：主机发送模式，SCL为高时，SDA由高到低；P：主机发送模式，SCL为高时，SDA由低到高；</li>
<li>A：主机切换为接收模式，传输一字节后SDA先拉低，在拉高SCL，高电平在持续时间中重新拉高SDA。NA则SDA不拉低。</li>
<li>数据传输：SCL为时钟，在SCL为高时数据有效。</li>
</ul>
<p>（软件实现要注意高低电平的建立时间和持续时间保证传输正确）</p>
<ul>
<li>
<p>代码可以参考正点原子</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码由正点原子提供</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;myiic.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="comment">//IO方向设置</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_IN()  &#123;GPIOB-&gt;MODER&amp;=~(3<span class="meta-string">&lt;&lt;(9*2));GPIOB-&gt;</span>MODER|=0&lt;&lt;9*2;&#125;	<span class="comment">//PB9输入模式</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_OUT() &#123;GPIOB-&gt;MODER&amp;=~(3<span class="meta-string">&lt;&lt;(9*2));GPIOB-&gt;</span>MODER|=1&lt;&lt;9*2;&#125; <span class="comment">//PB9输出模式</span></span></span><br><span class="line"><span class="comment">//IO操作</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IIC_SCL   PBout(8) <span class="comment">//SCL</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IIC_SDA   PBout(9) <span class="comment">//SDA</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SDA  PBin(9)  <span class="comment">//输入SDA</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IIC_Init</span><span class="params">(<span class="keyword">void</span>)</span>		<span class="comment">//IIC初始化</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GPIO_InitTypeDef GPIO_Initure;</span><br><span class="line">    __HAL_RCC_GPIOB_CLK_ENABLE();   <span class="comment">//使能GPIOB时钟</span></span><br><span class="line">    <span class="comment">//PH4,5初始化设置</span></span><br><span class="line">    GPIO_Initure.Pin=GPIO_PIN_8|GPIO_PIN_9;</span><br><span class="line">    GPIO_Initure.Mode=GPIO_MODE_OUTPUT_PP;  <span class="comment">//推挽输出</span></span><br><span class="line">    GPIO_Initure.Pull=GPIO_PULLUP;          <span class="comment">//上拉</span></span><br><span class="line">    GPIO_Initure.Speed=GPIO_SPEED_FAST;     <span class="comment">//快速</span></span><br><span class="line">    HAL_GPIO_Init(GPIOB,&amp;GPIO_Initure);</span><br><span class="line">    IIC_SDA=<span class="number">1</span>;	<span class="comment">//SDA输出1</span></span><br><span class="line">    IIC_SCL=<span class="number">1</span>;  <span class="comment">//SCL输出1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IIC_Start</span><span class="params">(<span class="keyword">void</span>)</span>	<span class="comment">//产生IIC起始信号</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SDA_OUT();     <span class="comment">//sda线输出</span></span><br><span class="line">	IIC_SDA=<span class="number">1</span>;	  	  </span><br><span class="line">	IIC_SCL=<span class="number">1</span>;</span><br><span class="line">	delay_us(<span class="number">4</span>);</span><br><span class="line"> 	IIC_SDA=<span class="number">0</span>;<span class="comment">//START:when CLK is high,DATA change form high to low </span></span><br><span class="line">	delay_us(<span class="number">4</span>);</span><br><span class="line">	IIC_SCL=<span class="number">0</span>;<span class="comment">//钳住I2C总线，准备发送或接收数据 </span></span><br><span class="line">&#125;	  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IIC_Stop</span><span class="params">(<span class="keyword">void</span>)</span>		<span class="comment">//产生IIC停止信号</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SDA_OUT();<span class="comment">//sda线输出</span></span><br><span class="line">	IIC_SCL=<span class="number">0</span>;</span><br><span class="line">	IIC_SDA=<span class="number">0</span>;<span class="comment">//STOP:when CLK is high DATA change form low to high</span></span><br><span class="line"> 	delay_us(<span class="number">4</span>);</span><br><span class="line">	IIC_SCL=<span class="number">1</span>; </span><br><span class="line">	IIC_SDA=<span class="number">1</span>;<span class="comment">//发送I2C总线结束信号</span></span><br><span class="line">	delay_us(<span class="number">4</span>);							   	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等待应答信号到来</span></span><br><span class="line"><span class="comment">//返回值：1，接收应答失败；0，接收应答成功</span></span><br><span class="line"><span class="function">u8 <span class="title">IIC_Wait_Ack</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 ucErrTime=<span class="number">0</span>;</span><br><span class="line">	SDA_IN();      <span class="comment">//SDA设置为输入  </span></span><br><span class="line">	IIC_SDA=<span class="number">1</span>;delay_us(<span class="number">1</span>);	   </span><br><span class="line">	IIC_SCL=<span class="number">1</span>;delay_us(<span class="number">1</span>);	 </span><br><span class="line">	<span class="keyword">while</span>(READ_SDA)&#123;</span><br><span class="line">		ucErrTime++;</span><br><span class="line">		<span class="keyword">if</span>(ucErrTime&gt;<span class="number">250</span>)&#123;</span><br><span class="line">			IIC_Stop();</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	IIC_SCL=<span class="number">0</span>;<span class="comment">//时钟输出0 	   </span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//产生ACK应答</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IIC_Ack</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	IIC_SCL=<span class="number">0</span>;</span><br><span class="line">	SDA_OUT();</span><br><span class="line">	IIC_SDA=<span class="number">0</span>;</span><br><span class="line">	delay_us(<span class="number">2</span>);</span><br><span class="line">	IIC_SCL=<span class="number">1</span>;</span><br><span class="line">	delay_us(<span class="number">2</span>);</span><br><span class="line">	IIC_SCL=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不产生ACK应答		    </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IIC_NAck</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	IIC_SCL=<span class="number">0</span>;</span><br><span class="line">	SDA_OUT();</span><br><span class="line">	IIC_SDA=<span class="number">1</span>;</span><br><span class="line">	delay_us(<span class="number">2</span>);</span><br><span class="line">	IIC_SCL=<span class="number">1</span>;</span><br><span class="line">	delay_us(<span class="number">2</span>);</span><br><span class="line">	IIC_SCL=<span class="number">0</span>;</span><br><span class="line">&#125;					 				     </span><br><span class="line"><span class="comment">//IIC发送一个字节</span></span><br><span class="line"><span class="comment">//返回从机有无应答</span></span><br><span class="line"><span class="comment">//1，有应答</span></span><br><span class="line"><span class="comment">//0，无应答			  </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IIC_Send_Byte</span><span class="params">(u8 txd)</span></span></span><br><span class="line"><span class="function"></span>&#123;                        </span><br><span class="line">    u8 t;   </span><br><span class="line">	SDA_OUT(); 	    </span><br><span class="line">    IIC_SCL=<span class="number">0</span>;<span class="comment">//拉低时钟开始数据传输</span></span><br><span class="line">    <span class="keyword">for</span>(t=<span class="number">0</span>;t&lt;<span class="number">8</span>;t++)</span><br><span class="line">    &#123;              </span><br><span class="line">        IIC_SDA=(txd&amp;<span class="number">0x80</span>)&gt;&gt;<span class="number">7</span>;</span><br><span class="line">        txd&lt;&lt;=<span class="number">1</span>; 	  </span><br><span class="line">		delay_us(<span class="number">2</span>);   <span class="comment">//对TEA5767这三个延时都是必须的</span></span><br><span class="line">		IIC_SCL=<span class="number">1</span>;</span><br><span class="line">		delay_us(<span class="number">2</span>); </span><br><span class="line">		IIC_SCL=<span class="number">0</span>;	</span><br><span class="line">		delay_us(<span class="number">2</span>);</span><br><span class="line">    &#125;	 </span><br><span class="line">&#125; 	    </span><br><span class="line"><span class="comment">//读1个字节，ack=1时，发送ACK，ack=0，发送nACK   </span></span><br><span class="line"><span class="function">u8 <span class="title">IIC_Read_Byte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> ack)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i,receive=<span class="number">0</span>;</span><br><span class="line">	SDA_IN();<span class="comment">//SDA设置为输入</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++ )</span><br><span class="line">	&#123;</span><br><span class="line">        IIC_SCL=<span class="number">0</span>; </span><br><span class="line">        delay_us(<span class="number">2</span>);</span><br><span class="line">		IIC_SCL=<span class="number">1</span>;</span><br><span class="line">        receive&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(READ_SDA)receive++;   </span><br><span class="line">		delay_us(<span class="number">1</span>); </span><br><span class="line">    &#125;					 </span><br><span class="line">    <span class="keyword">if</span> (!ack)</span><br><span class="line">        IIC_NAck();<span class="comment">//发送nACK</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        IIC_Ack(); <span class="comment">//发送ACK   </span></span><br><span class="line">    <span class="keyword">return</span> receive;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="2-直接利用stm32自带的硬件i2c"><a class="markdownIt-Anchor" href="#2-直接利用stm32自带的硬件i2c"></a> 2、直接利用STM32自带的硬件I2C</h3>
<ul>
<li><strong>优点</strong>：传输时候为硬件传输，不占用CPU；传输稳定；速度快；支持DMA传输；</li>
<li><strong>缺点</strong>：只能采用固定IO口；配置寄存器比较复杂；据说旧版标准库中I2C的调用存在bug，HAL库目前没有遇到问题；</li>
<li><strong>实现方法</strong>：配置好I2C后直接调用HAL库函数即可</li>
</ul>
<h2 id="三-stm32f4探索者i2c实验"><a class="markdownIt-Anchor" href="#三-stm32f4探索者i2c实验"></a> 三、STM32F4探索者I2C实验</h2>
<p><strong>实验目的</strong>：利用<strong>硬件I2C</strong>实现对24c02存储芯片进行读写</p>
<h3 id="1-配置相关设置"><a class="markdownIt-Anchor" href="#1-配置相关设置"></a> 1、配置相关设置</h3>
<ul>
<li>外部时钟开启——&gt;时钟树配置</li>
<li>LCD显示（FSMC，PB15）配置</li>
<li>按键控制配置</li>
<li>硬件I2C配置</li>
</ul>
<h4 id="1外部晶振打开时钟树配置如下"><a class="markdownIt-Anchor" href="#1外部晶振打开时钟树配置如下"></a> （1）外部晶振打开，时钟树配置如下：</h4>
<img src="STM32单片机HAL库学习（macOS）（5）——I2C通信/配置时钟树.png" alt="配置时钟树" style="zoom:50%;" />
<h4 id="2lcd显示相关配置"><a class="markdownIt-Anchor" href="#2lcd显示相关配置"></a> （2）LCD显示相关配置</h4>
<p>详情见 <a href="/Quark/2020/12/21/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%884%EF%BC%89%E2%80%94%E2%80%94LCD%E6%98%BE%E7%A4%BA/" title="STM32单片机HAL库学习MacOS（4）——LCD显示">STM32单片机HAL库学习MacOS（4）——LCD显示</a></p>
<h4 id="3按键我们只需要用到key1与key0"><a class="markdownIt-Anchor" href="#3按键我们只需要用到key1与key0"></a> （3）按键我们只需要用到key1与key0</h4>
<img src="STM32单片机HAL库学习（macOS）（5）——I2C通信/Key配置.png" alt="Key配置" style="zoom:50%;" />
<h4 id="4硬件i2c配置与硬件连接connectivity-i2c1"><a class="markdownIt-Anchor" href="#4硬件i2c配置与硬件连接connectivity-i2c1"></a> （4）硬件I2C配置与硬件连接（connectivity -&gt; I2C1）</h4>
<p>如下图配置即可。<strong>注意</strong>：由于I2C硬件接口有多个，当我们打开I2C1接口时，默认的引脚可能不是我们所要用到的（第一次没注意还以为程序除了bug啥都没显示）根据开发版所给的资料显示，I2C接口处于<strong>PB8和PB9</strong>的IO口，因此我们需要在STM32cubeMX配置过程点击PB8和PB9手动调整。</p>
<img src="STM32单片机HAL库学习（macOS）（5）——I2C通信/24C02硬件连接.png" alt="24C02硬件连接" style="zoom:30%;" />
<p><img src="STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/I2C%E9%85%8D%E7%BD%AE.png" alt="I2C配置" /></p>
<p>配置好后生成代码～</p>
<h3 id="2-24c02芯片连接以及读写"><a class="markdownIt-Anchor" href="#2-24c02芯片连接以及读写"></a> 2、24c02芯片连接以及读写</h3>
<ul>
<li>
<p><strong>地址</strong>：24c02芯片为I2C接口，地址为7-bit格式，在开发板上A2-A0为0，最低位为读写控制。因此写的时候地址为0xA0，读地址为0xA1。</p>
  <img src="STM32单片机HAL库学习（macOS）（5）——I2C通信/24c02地址.png" alt="24c02地址" style="zoom:50%;" />
</li>
<li>
<p><strong>存储方式</strong>：查阅24c02的芯片手册可以知道24c02中数据由32页存储，每页存储8字节，寻址格式为<strong>8bit</strong>。同时24c02最多支持页写入，而读取是没有限制的。</p>
<p><img src="STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94I2C%E9%80%9A%E4%BF%A1/24c02%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F.png" alt="24c02存储方式" /></p>
</li>
<li>
<p><strong>读写</strong>：在芯片手册中有提到，写入最多一口气<strong>写8字节</strong>（页写入），且写入后需要等待<strong>10ms</strong>才会把数据存储好。</p>
</li>
</ul>
<h3 id="3-hal库函数介绍"><a class="markdownIt-Anchor" href="#3-hal库函数介绍"></a> 3、HAL库函数介绍</h3>
<ul>
<li>
<p>HAL库中自带I2C调用函数，可以在<code>“stm32f4xx_hal_i2c.c”</code>中查看，在<strong>不用DMA和中断</strong>情况下，主要有以下函数：</p>
<ul>
<li>
<pre class="highlight"><code class="c">  <span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_I2C_Master_Transmit</span><span class="hljs-params">(I2C_HandleTypeDef *hi2c, <span class="hljs-keyword">uint16_t</span> DevAddress, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;
  <span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_I2C_Master_Receive</span><span class="hljs-params">(I2C_HandleTypeDef *hi2c, <span class="hljs-keyword">uint16_t</span> DevAddress, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;
  <span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_I2C_Slave_Transmit</span><span class="hljs-params">(I2C_HandleTypeDef *hi2c, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;
  <span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_I2C_Slave_Receive</span><span class="hljs-params">(I2C_HandleTypeDef *hi2c, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;
  <span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_I2C_Mem_Write</span><span class="hljs-params">(I2C_HandleTypeDef *hi2c, <span class="hljs-keyword">uint16_t</span> DevAddress, <span class="hljs-keyword">uint16_t</span> MemAddress, <span class="hljs-keyword">uint16_t</span> MemAddSize, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;
  <span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_I2C_Mem_Read</span><span class="hljs-params">(I2C_HandleTypeDef *hi2c, <span class="hljs-keyword">uint16_t</span> DevAddress, <span class="hljs-keyword">uint16_t</span> MemAddress, <span class="hljs-keyword">uint16_t</span> MemAddSize, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;
  <span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_I2C_IsDeviceReady</span><span class="hljs-params">(I2C_HandleTypeDef *hi2c, <span class="hljs-keyword">uint16_t</span> DevAddress, <span class="hljs-keyword">uint32_t</span> Trials, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span>;
  &lt;!--code￼<span class="hljs-number">1</span>--&gt;

</code></pre>
</li>
</ul>
</li>
</ul>
<p>改写正点原子24c02的用处在于以后用到正点原子相关外设（例如触摸模块）涉及到24c02时不用额外编写新代码，可以直接兼容使用。</p>
<h4 id="2hal库实现"><a class="markdownIt-Anchor" href="#2hal库实现"></a> （2）HAL库实现</h4>
<p>如果仔细发现上面改写的代码可能就会已经明白HAL库的直接写法，例子如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取全部存储空间</span></span><br><span class="line"><span class="comment">//读取没有限制，可一口气读取全部</span></span><br><span class="line">HAL_I2C_Mem_Read(&amp;hi2c1,<span class="number">0xA1</span>,<span class="number">0</span>,I2C_MEMADD_SIZE_8BIT,I2C_Buffer_Read,<span class="number">256</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="comment">//写入全部存储空间</span></span><br><span class="line"><span class="keyword">uint8_t</span> I2C_Buffer_Write[<span class="number">256</span>]=&#123;<span class="string">&quot;STM32 EXPORER I2C TEST...&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">uint8_t</span> I2C_Buffer_Read[<span class="number">256</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">uint16_t</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i=i+<span class="number">8</span>)<span class="comment">//页写入，一次最多8字节</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(HAL_I2C_Mem_Write(&amp;hi2c1,<span class="number">0xA0</span>,i,I2C_MEMADD_SIZE_8BIT,&amp;(I2C_Buffer_Write[i]),<span class="number">8</span>,<span class="number">1000</span>)==HAL_OK)<span class="comment">//若传输完成</span></span><br><span class="line">	&#123;</span><br><span class="line">		HAL_Delay(<span class="number">10</span>);<span class="comment">//等待10ms</span></span><br><span class="line">	&#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">break</span>;&#125;<span class="comment">//传输失败，结束写入</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3加上按键控制和显示完善例程"><a class="markdownIt-Anchor" href="#3加上按键控制和显示完善例程"></a> （3）加上按键控制和显示完善例程</h4>
<p>最后加上按键的操作就可以实现key1写入，key0读出，最后再用LCD显示。以下是完整代码。</p>
<p>Here~ <a target="_blank" rel="noopener" href="https://gitee.com/zhuang-jiaxin_gitee/zhuang-jiaxin_gitee/raw/master/download/24C02.zip">点击下载</a></p>
<hr />
<p>END</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/Quark/tags/STM32cubeIDE/" rel="tag"># STM32cubeIDE</a>
              <a href="/Quark/tags/STM32/" rel="tag"># STM32</a>
              <a href="/Quark/tags/I2C/" rel="tag"># I2C</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Quark/2021/01/22/STM32%E5%8D%95%E7%89%87%E6%9C%BAHAL%E5%BA%93%E5%AD%A6%E4%B9%A0%EF%BC%88macOS%EF%BC%89%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94/" rel="prev" title="STM32之HAL库学习——电子时钟项目（1）">
      <i class="fa fa-chevron-left"></i> STM32之HAL库学习——电子时钟项目（1）
    </a></div>
      <div class="post-nav-item">
    <a href="/Quark/2021/02/23/STM32HAL%E5%BA%93%E5%AD%A6%E4%B9%A0MacOS%EF%BC%886%EF%BC%89%E2%80%94%E2%80%94SPI%E9%80%9A%E4%BF%A1/" rel="next" title="STM32HAL库学习（6）——SPI通信">
      STM32HAL库学习（6）——SPI通信 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text"> 目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80-i2c%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text"> 一、I2C协议介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-i2c%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86"><span class="nav-number">2.1.</span> <span class="nav-text"> 1、I2C通信原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-i2c%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="nav-number">2.2.</span> <span class="nav-text"> 2、I2C时序图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C-stm32%E4%B8%8Ai2c%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text"> 二、STM32上I2C的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%A9%E7%94%A8io%E5%8F%A3%E6%A8%A1%E6%8B%9Fi2c%E5%AE%9E%E7%8E%B0%E9%80%9A%E4%BF%A1"><span class="nav-number">3.1.</span> <span class="nav-text"> 1、利用IO口模拟I2C实现通信</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%9B%B4%E6%8E%A5%E5%88%A9%E7%94%A8stm32%E8%87%AA%E5%B8%A6%E7%9A%84%E7%A1%AC%E4%BB%B6i2c"><span class="nav-number">3.2.</span> <span class="nav-text"> 2、直接利用STM32自带的硬件I2C</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89-stm32f4%E6%8E%A2%E7%B4%A2%E8%80%85i2c%E5%AE%9E%E9%AA%8C"><span class="nav-number">4.</span> <span class="nav-text"> 三、STM32F4探索者I2C实验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE"><span class="nav-number">4.1.</span> <span class="nav-text"> 1、配置相关设置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E5%A4%96%E9%83%A8%E6%99%B6%E6%8C%AF%E6%89%93%E5%BC%80%E6%97%B6%E9%92%9F%E6%A0%91%E9%85%8D%E7%BD%AE%E5%A6%82%E4%B8%8B"><span class="nav-number">4.1.1.</span> <span class="nav-text"> （1）外部晶振打开，时钟树配置如下：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2lcd%E6%98%BE%E7%A4%BA%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="nav-number">4.1.2.</span> <span class="nav-text"> （2）LCD显示相关配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E6%8C%89%E9%94%AE%E6%88%91%E4%BB%AC%E5%8F%AA%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0key1%E4%B8%8Ekey0"><span class="nav-number">4.1.3.</span> <span class="nav-text"> （3）按键我们只需要用到key1与key0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E7%A1%AC%E4%BB%B6i2c%E9%85%8D%E7%BD%AE%E4%B8%8E%E7%A1%AC%E4%BB%B6%E8%BF%9E%E6%8E%A5connectivity-i2c1"><span class="nav-number">4.1.4.</span> <span class="nav-text"> （4）硬件I2C配置与硬件连接（connectivity -&gt; I2C1）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-24c02%E8%8A%AF%E7%89%87%E8%BF%9E%E6%8E%A5%E4%BB%A5%E5%8F%8A%E8%AF%BB%E5%86%99"><span class="nav-number">4.2.</span> <span class="nav-text"> 2、24c02芯片连接以及读写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-hal%E5%BA%93%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.3.</span> <span class="nav-text"> 3、HAL库函数介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2hal%E5%BA%93%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.3.1.</span> <span class="nav-text"> （2）HAL库实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E5%8A%A0%E4%B8%8A%E6%8C%89%E9%94%AE%E6%8E%A7%E5%88%B6%E5%92%8C%E6%98%BE%E7%A4%BA%E5%AE%8C%E5%96%84%E4%BE%8B%E7%A8%8B"><span class="nav-number">4.3.2.</span> <span class="nav-text"> （3）加上按键控制和显示完善例程</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Chris"
      src="https://gitee.com/zhuang-jiaxin_gitee/pictures/raw/master/img/0df431adcbef76096e34ebdc26dda3cc7cd99eb1-20210706060646187.jpeg">
  <p class="site-author-name" itemprop="name">Chris</p>
  <div class="site-description" itemprop="description">I hope that I am a pioneer and my efforts can bring better technology and things to everyone.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/Quark/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/Quark/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/Quark/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/chrisz-nju" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chrisz-nju" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/Quark/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chris</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/Quark/lib/anime.min.js"></script>
  <script src="/Quark/lib/velocity/velocity.min.js"></script>
  <script src="/Quark/lib/velocity/velocity.ui.min.js"></script>

<script src="/Quark/js/utils.js"></script>

<script src="/Quark/js/motion.js"></script>


<script src="/Quark/js/schemes/muse.js"></script>


<script src="/Quark/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
